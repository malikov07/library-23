{% extends 'base.html' %}
{% load static %}
{% block content %}

    <title>Library Statistics</title>
    <script src="{% static 'old/assets/js/statistics.js' %}"></script>
    <link href="{% static 'old/assets/css/bootstrap.css' %}" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            color: #333;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin-bottom: 20px;
            color: #555;
        }

        .chart-container {
            background-color: #e6e6fa;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #barChart {
            max-height: 400px;
            /* Adjust this value as needed */
        }
    </style>


<body>
    <div class="container">
        <a style="color: white;" href="{% url 'library' %}"><button class="btn btn-primary mt-3"><i
            class="bi bi-arrow-left h2"></i></button></a>
        <h1 class="my-5">Kutubxona statistikasi</h1>
        <div class="row mb-5">
            <!-- Line Chart -->
            <div class="col-md-8">
                <canvas  id="lineChart"></canvas>
            </div>

            <!-- Pie Chart -->
            <div class="col-md-4" style="max-height: 500px;">
                <canvas id="pieChart"></canvas>
            </div>

            <!-- Bar Chart -->
            <div class="col-md-12">
                <canvas id="barChart"></canvas>
            </div>
        </div>
        <div class="row mb-5">

            <div class="col-md-12">
                <h1>Top 5 o'quvchilar</h1>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">F.I.SH</th>
                            <th scope="col">Sinfi</th>
                            <th scope="col">Ball</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in top_students %}
                        <tr>
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{student.first_name}} {{student.last_name}} {{student.third_name}}</td>
                            <td>{{student.sinf}}</td>
                            <td>{{student.ball}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-md-12">
                <h1>Sinflar Darajalari</h1>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Sinf</th>
                            <th scope="col">Ball</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for sinf in classes_rank %}
                        <tr>
                            <th scope="row">{{forloop.counter}}</th>
                            <td>{{sinf}}</td>
                            <td>{{sinf.total_ball}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


        <script>
            // Data for charts

            const monthTranslation = {
                "January": "Yanvar",
                "February": "Fevral",
                "March": "Mart",
                "April": "Aprel",
                "May": "May",
                "June": "Iyun",
                "July": "Iyul",
                "August": "Avgust",
                "September": "Sentyabr",
                "October": "Oktyabr",
                "November": "Noyabr",
                "December": "Dekabr"
            };

            // Translated labels for the chart
            const labels = [
                {% for entry in rentals_by_month %}
                    monthTranslation["{{ entry.month|date:'F' }}"],
                {% endfor %}
            ];
            const lineChartData = {
                labels: labels,
                datasets: [{
                    label: "O'qilgan kitoblar",
                    borderColor: '#0078ff',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    data: [
                        {% for entry in rentals_by_month %}
                            {{ entry.total }},
                        {% endfor %}
                    ],
                    pointRadius: 10, // Increase this value to make points larger
                }]
            };

            const lineChartOptions = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.dataset.label + ': ' + tooltipItem.raw;
                            }
                        },
                        bodyFont: {
                            size: 16, // Increase this value to make the font larger
                        },
                        titleFont: {
                            size: 18, // Increase this value to make the title font larger
                        },
                    }
                }
            };

            const barChartData = {
                labels: [
                    {% for sinf in sinf_ball_sum %}
                        '{{sinf}}',
                    {% endfor %}
                ],
                datasets: [{
                    label: 'Ball',
                    data: [
                        {% for sinf in sinf_ball_sum %}
                            {{sinf.total_ball}},
                        {% endfor %} 
                    ],
                    backgroundColor: [
                        {% for color,i in colors %}
                            '{{ color }}',
                        {% endfor %}
                    ],
                    borderColor: [
                        {% for color,i in colors %}
                            '{{ i }}',  // Adjust the opacity for border
                        {% endfor %}
                    ],
                    borderWidth: 2
                }]
            };

            const barChartOptions = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.dataset.label + ': ' + tooltipItem.raw;
                            }
                        },
                        bodyFont: {
                            size: 16, // Increase this value to make the font larger
                        },
                        titleFont: {
                            size: 18, // Increase this value to make the title font larger
                        },
                    }
                }
            };

            const pieChartData = {
                labels: ["Kitob o'qiyotganlar", "Kitob o'qimayotganlar"],
                datasets: [{
                    label: 'Taqqoslash',
                    data: [{{r_percent}},{{nr_percent}}],
                    backgroundColor: [
                        'rgb(30, 255, 0, 0.4)',
                        'rgba(255, 25, 0, 0.4)'
                    ],
                    hoverOffset: 4
                }]
            };

            const pieChartOptions = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw;
                            }
                        },
                        bodyFont: {
                            size: 16, // Increase this value to make the font larger
                        },
                        titleFont: {
                            size: 18, // Increase this value to make the title font larger
                        },
                    }
                }
            };

            // Creating the charts
            new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: lineChartData,
                options: lineChartOptions,
            });

            new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: barChartData,
                options: barChartOptions,
            });

            new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: pieChartData,
                options: pieChartOptions,
            });
        </script>
</body>
{% endblock %}

